<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage"><head>
  <link href="https://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5" />

  <title>
  
    Fuse.js Static Site Search and GitLab Pages | HugoModo - A modular Hugo framework.
  
</title>


  <meta name="description" content="A modular Hugo framework." />

  
  



  

  

  







  
  

  

  
  

  

  
  

  





  

  
    
    <link rel="stylesheet" type="text/css" href="/css/style.min.5642fa90f1551466f3397fc8c479d9657070ecc939fc08ff1a26b0122c509a04.css" integrity="sha256-VkL6kPFVFGbzOX/IxHnZZXBw7Mk5/Aj/GiawEixQmgQ=">
  


  


  
  


  
  
  

<meta itemprop="name" content="Fuse.js Static Site Search and GitLab Pages">
<meta itemprop="description" content="The greatest selling point of static sites over dynamic is also their greatest drawback. They&rsquo;re essentially serverless. That means no logins, no dynamic rendering and no form submissions. Of course there are workarounds for all of these, and with the right setup nobody will be able to tell the difference.
So, how does search work? Classically, you&rsquo;d require a server. Your search query would be delivered to the server, it would query its own database for matches, and the results would be returned with the next page load (or delivered as a parseable document in the case of dynamic queries made using JavaScript).">


<meta itemprop="datePublished" content="2019-01-04T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-01-04T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="629">



<meta itemprop="keywords" content="" />


  
  <meta property="og:title" content="Fuse.js Static Site Search and GitLab Pages" />
  <meta property="og:description" content="The greatest selling point of static sites over dynamic is also their greatest drawback. They&rsquo;re essentially serverless. That means no logins, no dynamic rendering and no form submissions. Of course there are workarounds for all of these, and with the right setup nobody will be able to tell the difference.
So, how does search work? Classically, you&rsquo;d require a server. Your search query would be delivered to the server, it would query its own database for matches, and the results would be returned with the next page load (or delivered as a parseable document in the case of dynamic queries made using JavaScript)." />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://hugomodo.github.io/blog/static-site-search-and-gitlab-pages/" />

  


<meta property="article:published_time" content="2019-01-04T00:00:00&#43;00:00"/>
  <meta property="article:modified_time" content="2019-01-04T00:00:00&#43;00:00"/>


  
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Fuse.js Static Site Search and GitLab Pages"/>
<meta name="twitter:description" content="The greatest selling point of static sites over dynamic is also their greatest drawback. They&rsquo;re essentially serverless. That means no logins, no dynamic rendering and no form submissions. Of course there are workarounds for all of these, and with the right setup nobody will be able to tell the difference.
So, how does search work? Classically, you&rsquo;d require a server. Your search query would be delivered to the server, it would query its own database for matches, and the results would be returned with the next page load (or delivered as a parseable document in the case of dynamic queries made using JavaScript)."/>


  



  
  
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans">



  




  
  

</head>
<body><header>
  <h1>
    <a title="HugoModo" href="/">HugoModo</a>
  </h1>
  <nav>
  <ul>
    
    
    
      
        <li>
          <a href="https://hugomodo.github.io/blog/" title="Blog">Blog</a>
        </li>
      
    
      
        <li>
          <a href="https://hugomodo.github.io/docs/" title="Docs">Docs</a>
        </li>
      
    
      
        <li>
          <a href="https://hugomodo.github.io/extensions/" title="Extensions">Extensions</a>
        </li>
      
    
      
        <li>
          <a href="https://hugomodo.github.io/themes/" title="Themes">Themes</a>
        </li>
      
    
      
        <li>
          <a href="https://hugomodo.github.io/search/" title="Search">Search</a>
        </li>
      
    
  </ul>
</nav>

</header>

  <main>
    <header>
      <nav>
  <ul class="breadcrumbs">
    
  
    
  
    
  

  
    
  

  <li class="">
    
      <a href="https://hugomodo.github.io/">HugoModo</a>
    
  </li>

  

  
    
  

  <li class="">
    
      <a href="https://hugomodo.github.io/blog/">Blog</a>
    
  </li>

  

  
    
  

  <li class="active">
    
      
        Fuse.js Static Site Search and GitLab Pages
      
    
  </li>

  </ul>
</nav>



    </header>
    <article>
      

      <header>
  <h2>Fuse.js Static Site Search and GitLab Pages</h2>
</header>

      <aside>
  <dl>
    <dt>Published</dt>
<dd><time datetime="2019-01-04T00:00:00&#43;00:00" itemprop="datePublished">04 Jan 2019</time></dd>


    

    
  <dt>Reading time</dt>
  <dd><time datetime="3m">3 minutes</time></dd>



    



   
  
  
    <dt>Authors</dt>
    
      
      
      
        <dd>
          <a href="/authors/thom-bruce">
            Thom Bruce
          </a>
        </dd>
      
    
  

   
  
  

   
  
  

   
  
  


  </dl>
</aside>

      <section>
  
    
      
    
      
    

    

    

    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
      <p>The greatest selling point of static sites over dynamic is also their greatest drawback. They&rsquo;re essentially serverless. That means no logins, no dynamic rendering and no form submissions. Of course there are workarounds for all of these, and with the right setup nobody will be able to tell the difference.</p>

<p>So, how does search work? Classically, you&rsquo;d require a server. Your search query would be delivered to the server, it would query its own database for matches, and the results would be returned with the next page load (or delivered as a parseable document in the case of dynamic queries made using JavaScript).</p>

<p>One way in which static sites work around this limitation is by using a third-party API server. Essentially, you provide that server with your indexed content, they store it in their database, and then you can query the API for search results. This works, but I fear it produces two related issues. First, it&rsquo;s an extra dependency we don&rsquo;t necessarily want. And second, that index will need updated which means finding a way to communicate with the API when content is updated (it would be tedious to have to manually update the index every single time).</p>

<p>With HugoModo, I&rsquo;m initially trying to keep dependencies on the lighter side. If it&rsquo;s possible without a server dependency, all the better. And it is! Which is why I put together an extension that uses <a href="http://fusejs.io/">Fuse.js</a>.</p>

<p><a href="/extensions/fusejs">HugoModo FuseJS</a> provides a search page template, a JSON index layout and the JavaScript files required to get it all working. That JSON index is the same as the index those third-party providers would expect, so this is a necessary step anyway. And once we have it, why not use it ourselves?</p>

<p>So that&rsquo;s how our extension handles it: it queries that index, created with our site and stored publicly.</p>

<p>And it just works! &hellip;in GitHub Pages, in Netlify&hellip;</p>

<p>&hellip;but not in GitLab Pages. I was surprised. You might be surprised too. The reason it doesn&rsquo;t work appears to be the very same thing that we thought we were getting away from by choosing a static site generator like Hugo: it seems the server is to blame.</p>

<p>So, yes, static sites aren&rsquo;t strictly serverless. They just run on very minimal servers. And when we submit a search form on our site in GitLab Pages in particular, their servers appear to be stripping the query parameters and redirecting to the search results page, albeit without the necessary search query. I go into further detail in an issue I opened on the GitLab Pages repo: <a href="https://gitlab.com/gitlab-org/gitlab-pages/issues/191">#191</a>.</p>

<p>Frustrating, but perhaps submitting the query as a full page request was never the right way to handle it anyway. This has prompted me to make that Fuse.js extension a little niftier.</p>

<p>We work around the problem like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">jQuery</span>(<span style="color:#e6db74">&#34;#search-query&#34;</span>).<span style="color:#a6e22e">parent</span>().<span style="color:#a6e22e">submit</span>(<span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">event</span> ) {
  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">jQuery</span>(<span style="color:#e6db74">&#34;#search-query&#34;</span>).<span style="color:#a6e22e">val</span>()){
    <span style="color:#a6e22e">executeSearch</span>(<span style="color:#a6e22e">jQuery</span>(<span style="color:#e6db74">&#34;#search-query&#34;</span>).<span style="color:#a6e22e">val</span>());
  } <span style="color:#66d9ef">else</span> {
    <span style="color:#a6e22e">jQuery</span>(<span style="color:#e6db74">&#39;#search-results&#39;</span>).<span style="color:#a6e22e">html</span>(<span style="color:#e6db74">&#34;&lt;p&gt;Please enter a word or phrase above&lt;/p&gt;&#34;</span>);
  }
  <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">preventDefault</span>();
});
</code></pre></div>
<p><em>Yup, sadly jQuery is still a dependency for now. I&rsquo;m working on it!</em></p>

<p>So, above we hijack the <code>.submit</code> function, and importantly at the bottom there we <code>preventDefault()</code> behaviour which would be to submit the form alongside a page request. Instead, if a value is present we execute our search using that value, the script for which is, and always has been, run as JavaScript on the page (we can&rsquo;t use a server, remember). You may peruse the full file if you wish, here: <a href="https://github.com/hugomodo/hugomodo-fusejs/blob/master/assets/js/search.js">HugoModo FuseJS Search Script</a>, based on a <a href="https://gist.github.com/eddiewebb/735feb48f50f0ddd65ae5606a1cb41ae">GitHub Gist by eddiewebb</a>.</p>

<p>Problem solved then. Search results are now loaded, or more accurately displayed, without a page refresh.</p>

<p>But I do hope that GitLab Pages can support form submissions in the future. Silly as they may seem on static sites, they do still open up a lot of possibilities!</p>

    
  
</section>

      
        


  <footer>
    
    <section class="authors">
      <header>
        <h3>Author</h3>
      </header>
      
        
        
        
          <article class="author">
  



  
  
    <figure>
      <a href="https://hugomodo.github.io/authors/thom-bruce/">
        <img src="/uploads/thombruce.jpg"/>
      </a>
    </figure>
  
  <header>
    <h4>
      <a href="https://hugomodo.github.io/authors/thom-bruce/">
        Thom Bruce
      </a>
    </h4>
  </header>
  <section class="bio">
    
      <p>Author, coder.</p>
    
  </section>
  
  <address>
    <dl>
      
        <dt>Email</dt>
        <dd><a href="mailto:thom@thombruce.com">thom@thombruce.com</a></dd>
      
      
  
    <dt>Website</dt>
    <dd><a href="https://thombruce.com/">https://thombruce.com/</a></dd>
  
  
    <dt>GitHub</dt>
    <dd><a href="https://github.com/thombruce">thombruce</a></dd>
  
  
    <dt>Facebook</dt>
    <dd><a href="https://facebook.com/thombruce">thombruce</a></dd>
  
  
    <dt>Twitter</dt>
    <dd><a href="https://twitter.com/thombruce">thombruce</a></dd>
  
  
  
    <dt>LinkedIn</dt>
    <dd><a href="https://linkedin.com/in/thombruce">thombruce</a></dd>
  
  


    </dl>
  </address>




</article>

        
      
    </section>
  </footer>


      
    </article>
    <footer>
      

    </footer>
  </main>
<footer>
  
    <section><header>
  <h2>About HugoModo</h2>
</header>

  <section>
    <p>A modular Hugo framework.</p>
  </section>


  
  
  <address>
    <dl>
      
      
  
  
    <dt>GitHub</dt>
    <dd><a href="https://github.com/hugomodo">hugomodo</a></dd>
  
  
  
  
  
  


    </dl>
  </address>



</section>
  

  <section><h2>Sitemap</h2>
<nav>
  <ul>
    <li>
      <a href="/">Home</a>
    </li>
    
    
    
      <li>
        <a href="/blog/" title="Blog">Blog</a>
      </li>
    
      <li>
        <a href="/docs/" title="Docs">Docs</a>
      </li>
    
      <li>
        <a href="/extensions/" title="Extensions">Extensions</a>
      </li>
    
      <li>
        <a href="/themes/" title="Themes">Themes</a>
      </li>
    
    
      
        <li>
          <a href="https://hugomodo.github.io/search/" title="Search">Search</a>
        </li>
      
    
    
      
        <li>
          <a href="/authors" title="Authors">Authors</a>
        </li>
      
    
      
    
      
    
      
        <li>
          <a href="/tags" title="Tags">Tags</a>
        </li>
      
    
    <li>
      <a title="Subscribe" aria-label="Subscribe" href="/index.xml">
        RSS Feed
      </a>
    </li>
  </ul>
</nav>
</section>

  <section>
    <p>
  &copy; 2019 HugoModo.
  Built with <a href='https://hugomodo.github.io/' target='_blank'>HugoModo</a>.
</p>

  </section>
</footer>
<div id="contrast">
  Add more contrast
</div>

<div id="invmode">
  Inverted mode
</div>











  

  

  





  
  
  

  
  
  

  
  
  

  
  
  

  
  
  





  

  

  
    
    <script src="https://hugomodo.github.io/js/global.min.a0eb8d3d97ebd9f8dc07d64b140c5820c24085a8df9d53ab1b2faf15d64436ca.js" integrity="sha256-oOuNPZfr2fjcB9ZLFAxYIMJAhajfnVOrGy&#43;vFdZENso="></script>
  




</body>
</html>
